## 1. 高并发

> 高并发（High Concurrency）是互联网分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计保证系统能够同时并行处理很多请求。
高并发相关常用的一些指标有响应时间（Response Time），吞吐量（Throughput），每秒查询率QPS（Query Per Second），并发用户数等。

 - 响应时间：系统对请求做出响应的时间。例如系统处理一个HTTP请求需要200ms，这个200ms就是系统的响应时间。
- 吞吐量：单位时间内处理的请求数量。
- QPS：每秒响应请求数。在互联网领域，这个指标和吞吐量区分的没有这么明显。
- 并发用户数：同时承载正常使用系统功能的用户数量。例如一个即时通讯系统，同时在线量一定程度上代表了系统的并发用户数。

#### 如何提高并发能力
- 垂直扩展
- 1. 增强单机硬件性能（优先）：例如：增加CPU核数如32核，升级更好的网卡如万兆，升级更好的硬盘如SSD，扩充硬盘容量如2T，扩充系统内存如128G。
- 2. 提升单机架构性能：例如：使用Cache来减少IO次数，使用异步来增加单服务吞吐量，使用无锁数据结构来减少响应时间。
- 水平扩展
- 1. 只要增加服务器数量，就能线性扩充系统性能。水平扩展对系统架构设计是有要求的，难点在于：如何在架构各层进行可水平扩展的设计。


### 2. 高可用
> 高可用性（High Availability）通常来描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性(一直都能用)。
> 全年停机不能超过31.5秒
> 6个9性能： 一直能用的概率为99.9999%

#### 高可用注意事项
1. 避免单点： 使用单个服务器，一旦该服务器意外宕机，将导致服务不可用
2. 使用集群： 一台服务器挂了，还有其他后备服务器能够顶上
3. 心跳机制：用于**监控**服务器状态，挂了就进行**故障修复**


### 3. 高性能
> 简单的说，高性能就是指程序处理速度快，所占内存少，cpu占用率低
> 高并发和高性能是紧密相关的，提高应用的性能，是肯定可以提高系统的并发能力的
> 应用性能优化的时候，对于计算密集型和IO密级型还是有很大的区别的，需要分开考虑
> 增加服务器资源（CPU、内存、服务器数量），绝大部分时候是可以提高应用的并发能力和性能（前提是应用能够支持多任务并行计算，多服务分布式计算才行），但也是要避免其中的一些问题，才可以更好的更有效率的利用服务器资源。

#### 提高性能的注意事项
1. 避免因为IO阻塞让CPU闲置，导致CPU的浪费。
2. 避免多线程间增加锁来保证同步，导致并行系统串行化。
3. 免创建、销毁、维护太多进程、线程，导致操作系统浪费资源在调度上。
4. 避免分布式系统中多服务器的关联，比如：依赖同一个mysql，程序逻辑中使用分布式锁，导致瓶颈在mysql，分布式又变成串行化运算。

### 举例 （redis）
#### Redis中的主从复制
1. 场景
> 电子商务网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是“多读少写”。
2. 原理
> 一个Redis服务可以有多个该服务的复制品，这个Redis服务称为master，其他复制称为slaves。
![>](https://img-blog.csdnimg.cn/20210602183255362.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDg2MDI3,size_16,color_FFFFFF,t_70)
> 上图所示，我们将一台Redis服务器作主库（master），其他三台作为从库（slave), 主库只负责写数据，每次数据更新都将更新的数据同步到它所有的从库，而从库只负责读数据。这样一来，就有了两个好处：
> 1. 读写分离： 不仅可以提高服务器的负载能力，并且可以根据请求的规模自由增加或者减少从库的数量
> 2. 数据被复制成了好几份，就算有一台机器出现故障，也可以使用其他机器的数据快速回复。

**注意事项：** 在Redis主从模式中，一台主库可以拥有多个从库，但是一个从库的只能隶属于一个主库。
 
